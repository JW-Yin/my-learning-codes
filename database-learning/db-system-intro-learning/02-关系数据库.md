# 《数据库系统概论（第5版）》第二章 关系数据库大纲

## 第2章 关系数据库

这一章的内容是从静态到动态、从基础到工具的完整闭环：  
定义数据结构（是什么） → 定义关系操作（能做什么） → 定义完整性约束（要满足什么规则） → 给出理论工具（关系代数/演算，描述怎么做）

### 2.1 关系数据结构及形式化定义

#### 2.1.1 关系
- **域（domain）**
  - 一组具有相同数据类型值的集合
- **笛卡尔积（cartesian product）**
  - 给定一组域的笛卡尔积
  - n元组、分量、基数
- **关系（relation）**
  - 笛卡尔积的有限子集
  - 目或度（degree）
  - 属性（attribute）
  - 候选码（candidate key）、主码（primary key）
  - 主属性（prime attribute）、非主属性（non-prime attribute）
  - 全码（all-key）
- **关系类型**
  - 基本关系（基本表）、查询表、视图表
- **关系的限定和扩充**
  - 有限集合
  - 取消属性有序性
- **基本关系的性质**
  - 列同质
  - 不同列可出自同一域但需不同属性名
  - 列顺序无关
  - 任意两个元组的候选码不能相同
  - 行顺序无关
  - 分量必须取原子值（规范化）

#### 2.1.2 关系模式
- **关系模式定义**
  - 关系的描述
  - 形式化表示：R(U, D, DOM, F)
  - 简记：R(U) 或 R(A₁, A₂, ..., Aₙ)
- **关系模式与关系的区别**
  - 关系模式是型，静态稳定
  - 关系是值，动态变化

#### 2.1.3 关系数据库
- **关系数据库的型与值**
  - 型：关系数据库模式
  - 值：关系模式在某一时刻对应的关系的集合

#### 2.1.4 关系模型的存储结构
- **物理存储**
  - 表对应操作系统文件
  - 或由DBMS自行划分文件空间

### 2.2 关系操作

#### 2.2.1 基本的关系操作
- **查询操作**
  - 选择（select）、投影（project）、连接（join）
  - 除（divide）、并（union）、差（except）
  - 交（intersection）、笛卡尔积
- **更新操作**
  - 插入（insert）、删除（delete）、修改（update）
- **操作特点**
  - 集合操作方式（一次一集合）

#### 2.2.2 关系数据语言的分类
- **关系代数（relational algebra）**
  - 用对关系的运算表达查询
- **关系演算（relational calculus）**
  - 用谓词表达查询
  - 元组关系演算、域关系演算
- **结构化查询语言（SQL）**
  - 介于关系代数和关系演算之间
  - 集查询、DDL、DML、DCL于一体
  - 高度非过程化
- **关系完备性**
  - 能够表示关系代数可以表示的查询

### 2.3 关系的完整性

#### 2.3.1 实体完整性
- **实体完整性规则**
  - 主属性不能取空值
- **意义**
  - 保证每个元组可区分、唯一

#### 2.3.2 参照完整性
- **外码（foreign key）**
  - 与另一关系的主码相对应
  - 参照关系与被参照关系
- **参照完整性规则**
  - 外码值必须为空或等于被参照关系中某个主码值
- **示例**
  - 学生与专业关系
  - 学生、课程与选课关系
  - 同一关系内的参照

#### 2.3.3 用户定义的完整性
- **应用语义约束**
  - 属性取值唯一性
  - 非空约束
  - 取值范围约束
- **实现方式**
  - DBMS提供定义和检验机制
  - 早期由应用程序检查

### 2.4 关系代数

#### 2.4.1 传统的集合运算
- **并（union）**
  - R∪S = {t | t∈R ∨ t∈S}
- **差（except）**
  - R-S = {t | t∈R ∧ t∉S}
- **交（intersection）**
  - R∩S = {t | t∈R ∧ t∈S}
  - 可用差表示：R∩S = R - (R - S)
- **笛卡尔积（cartesian product）**
  - R×S = {tₐtᵦ | tₐ∈R ∧ tᵦ∈S}

#### 2.4.2 专门的关系运算
- **记号约定**
  - t[A] 表示元组t在属性组A上的值
  - 象集（image set）：Zₓ = {t[Z] | t∈R, t[X] = x}
- **选择（selection）**
  - σₓ(R) = {t | t∈R ∧ F(t) = true}
  - 从行角度进行运算
- **投影（projection）**
  - Πₐ(R) = {t[A] | t∈R}
  - 从列角度进行运算，取消重复行
- **连接（join）**
  - 等值连接（equijoin）：θ为"="
  - 自然连接（natural join）：特殊等值连接，取消重复列
  - 外连接（outer join）：保留悬浮元组
    - 左外连接（left outer join）
    - 右外连接（right outer join）
- **除运算（division）**
  - R÷S = {tᵣ[X] | tᵣ∈R ∧ Πᵧ(S) ⊆ Yₓ}
  - 同时从行和列角度运算
- **关系代数表达式**
  - 五种基本运算：并、差、笛卡尔积、选择、投影
  - 其他运算可用基本运算表达

### 2.5 关系演算

#### 2.5.1 元组关系演算语言ALPHA
- **语句基本格式**
  - 操作语句 工作空间名（表达式）：操作条件
- **检索操作**
  - GET语句实现
  - 简单检索、限定检索、带排序检索
  - 指定返回元组条数
  - 使用元组变量简化关系名或用于量词
  - 使用存在量词、全称量词、蕴涵的检索
  - 聚集函数：COUNT、TOTAL、MAX、MIN、AVG
- **更新操作**
  - 修改：HOLD-MOVE-UPDATE
  - 插入：MOVE-PUT
  - 删除：HOLD-DELETE
  - 主码修改需先删除后插入

#### 2.5.2 元组关系演算
- **原子公式**
  - R(t)：t是R的元组
  - t[i] θ u[j]：元组分量的比较
  - t[i] θ c 或 c θ t[i]：元组分量与常量的比较
- **公式递归定义**
  - 原子公式是公式
  - 逻辑运算：∧、∨、¬
  - 量词：∃、∀
- **关系代数运算的关系演算表示**
  - 并、差、笛卡尔积、投影、选择
- **安全性**
  - 安全表达式：不产生无限关系
  - 安全限制：定义有限的符号集dom(φ)

#### 2.5.3 域关系演算语言QBE
- **特点**
  - 通过例子进行查询（Query By Example）
  - 基于屏幕表格的查询语言
  - 高度非过程化，直观易用
- **检索操作**
  - 简单查询：示例元素、查询条件
  - 条件查询：与条件、或条件
  - 涉及多个关系的查询
  - 聚集函数：CNT、SUM、AVG、MAX、MIN
  - 查询结果排序：AO（升序）、DO（降序）
- **更新操作**
  - 修改操作：U.
  - 插入操作：I.
  - 删除操作：D.
  - 主码不允许修改

### 2.6 小结
- 关系数据库系统的重要性
- 关系模型的三部分：数据结构、关系操作、完整性约束
- 关系数据结构的形式化定义
- 关系代数和关系演算
- SQL作为关系数据库标准语言

---